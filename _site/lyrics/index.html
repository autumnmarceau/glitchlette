<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GLITCHLETTE Lyric Generator</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

  body {
    background: #0b0c10;
    color: #e0e0f8;
    font-family: 'Share Tech Mono', monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    min-height: 100vh;
    overflow-x: hidden;
  }

  h1 {
    margin-bottom: 1rem;
    color: #ff5555;
    text-shadow: 0 0 10px #ff4444;
  }

  /* Wrapper with CRT border */
  .crt-wrapper {
    position: relative;
    background: #12141a;
    border: 24px solid transparent;
    border-image: url('/photos/crt_border.png') 24 stretch;
    border-image-slice: 24;
    border-radius: 12px;
    box-sizing: border-box;
    max-width: 640px;
    width: 90%;
    box-shadow:
      0 0 20px #aa4444,
      inset 0 0 40px #bb5555;
    padding: 1.5rem;
    margin-bottom: 1rem;
    filter: drop-shadow(0 0 6px #cc6666);
    overflow-wrap: break-word;
    white-space: pre-wrap;
    user-select: none;
    font-size: 1.1rem;
    line-height: 1.5;
  }

  /* CRT scan lines overlay */
  .crt-wrapper::before {
    content: "";
    pointer-events: none;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      rgba(255,255,255,0.03) 0,
      rgba(255,255,255,0.06) 1px,
      transparent 2px,
      transparent 4px
    );
    z-index: 10;
    mix-blend-mode: overlay;
    animation: scanlineMove 3s linear infinite;
    border-radius: 12px;
  }
  @keyframes scanlineMove {
    0% {background-position: 0 0;}
    100% {background-position: 0 4px;}
  }

  /* Screen glitch flicker */
  .crt-wrapper::after {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(255,255,255,0.07) 50%,
      transparent 100%);
    mix-blend-mode: screen;
    opacity: 0.3;
    animation: flickerGlitch 0.2s infinite alternate;
    border-radius: 12px;
  }
  @keyframes flickerGlitch {
    0% {opacity: 0.3;}
    100% {opacity: 0.6;}
  }

  /* Glitch effect on the text */
  #lyric-output {
    color: #ffdddd;
    text-shadow:
      1px 0 #ff6666,
      -1px 0 #cc9999,
      0 1px #ee9999,
      0 -1px #cc6666;
    animation: glitchText 2s infinite;
    min-height: 200px;
    white-space: pre-wrap;
  }

  @keyframes glitchText {
    0%, 100% {
      text-shadow:
        1px 0 #ff6666,
        -1px 0 #cc9999,
        0 1px #ee9999,
        0 -1px #cc6666;
      transform: none;
    }
    20% {
      text-shadow:
        2px 0 #ff0000,
        -2px 0 #cc6666,
        0 2px #ff7777,
        0 -2px #cc5555;
      transform: translate(1px, -1px);
    }
    40% {
      text-shadow:
        0 0 #ff5555,
        0 0 #cc4444,
        1px 1px #ff9999,
        -1px -1px #cc7777;
      transform: translate(-1px, 1px);
    }
    60% {
      text-shadow:
        1px 1px #ff5555,
        -1px -1px #cc4444,
        0 0 #ff6666,
        0 0 #cc9999;
      transform: translate(1px, 1px);
    }
    80% {
      text-shadow:
        2px 2px #ff3333,
        -2px -2px #cc3333,
        0 0 #ff7777,
        0 0 #cc7777;
      transform: translate(-1px, -1px);
    }
  }

  /* Buttons */
  .btn-group {
    margin-bottom: 0.5rem;
  }
  button {
    margin: 0.3rem 0.5rem;
    padding: 0.8rem 1.5rem;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1rem;
    background: #a44c4c;
    color: #fef9f5;
    border: none;
    border-radius: 6px;
    box-shadow: 0 0 15px #d87f7f;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover {
    background-color: #d87f7f;
    box-shadow: 0 0 25px #ff9999;
  }

  /* Confirmation message */
  #copy-confirmation,
  #share-confirmation {
    color: #ff9999;
    font-size: 0.9rem;
    margin-top: 0.5rem;
    height: 1.2rem;
    visibility: hidden;
    user-select: none;
    text-align: center;
  }
  #copy-confirmation.visible,
  #share-confirmation.visible {
    visibility: visible;
  }

  /* Loading screen overlay */
  #loading-screen {
    position: fixed;
    inset: 0;
    background: linear-gradient(135deg, #1a1a1a 0%, #0b0c10 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 9999;
    color: #cc6666;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1.4rem;
    letter-spacing: 0.15em;
    text-shadow:
      0 0 8px #cc6666,
      0 0 20px #aa4444;
    user-select: none;
  }

  /* Flicker effect for loading text */
  #loading-text {
    animation: flicker 1.5s infinite alternate;
  }

  @keyframes flicker {
    0%, 100% {opacity: 1;}
    50% {opacity: 0.4;}
  }

  /* Modal backdrop */
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(11, 12, 16, 0.9);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    font-family: 'Share Tech Mono', monospace;
    color: #eee;
  }

  /* Modal box â€” now removed because we use crt-wrapper inside modal */
  /*
  .modal-content {
    background: #1c1e26;
    padding: 2rem;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 0 30px #ff5555;
  }
  */

  /* Form inputs */
  .modal-content input[type="text"],
  .modal-content textarea {
    width: 100%;
    padding: 0.6rem;
    margin-top: 0.3rem;
    border-radius: 6px;
    border: 1px solid #ff4444;
    background: #12141a;
    color: #eee;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1rem;
    resize: vertical;
  }

  /* Modal buttons */
  .modal-content button {
    margin-right: 1rem;
    background: #a44c4c;
    border: none;
    color: #fef9f5;
    cursor: pointer;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    font-family: 'Share Tech Mono', monospace;
    box-shadow: 0 0 15px #d87f7f;
    transition: background-color 0.3s ease;
  }
  .modal-content button:hover {
    background-color: #d87f7f;
  }

  /* Hidden by default */
  .hidden {
    display: none;
  }
  #loading-screen {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #1a1a1a 0%, #0b0c10 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 9999;
  color: #cc6666;
  font-family: 'Share Tech Mono', monospace;
  font-size: 1.4rem;
  letter-spacing: 0.15em;
  text-shadow: 0 0 8px #cc6666, 0 0 20px #aa4444;
  user-select: none;
  animation: fadeOutLoading 1s ease forwards;
  animation-delay: 3s; /* Delay before fade out */
  pointer-events: none; /* Prevent interaction after fade */
}

@keyframes fadeOutLoading {
  from {
    opacity: 1;
    visibility: visible;
  }
  to {
    opacity: 0;
    visibility: hidden;
  }
}


</style>
</head>
<body>

  <!-- Loading screen -->
  <div id="loading-screen">
    <div id="loading-text">loading lyrics_generator.exe</div>
  </div>

  <h1>Lyric Generator</h1>

  <div class="crt-wrapper" role="main" aria-live="polite" aria-atomic="true" aria-label="Generated lyric output">
    <div id="lyric-output" tabindex="0">Click "Generate" to create a glitchy lyric snippet.</div>
  </div>

  <div class="btn-group">
    <button id="generate-btn" aria-describedby="generate-desc">Generate</button>
    <button id="copy-btn" aria-describedby="copy-desc">Copy</button>
    <button id="view-shared-btn">View Shared Lyrics</button>
  </div>

  <div id="copy-confirmation" role="alert" aria-live="assertive">Copied to clipboard!</div>
  <div id="share-confirmation" role="alert" aria-live="assertive">Share link copied!</div>

  <button id="open-share-form" class="glitch-button" aria-haspopup="dialog" aria-controls="share-modal">Share Your Lyrics</button>

  <!-- Modal for sharing lyrics -->
  <div id="share-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
    <div class="crt-wrapper modal-content" style="max-width: 480px;">
      <h2 id="modal-title">Share Your Lyrics</h2>
      <p id="modal-desc">Submit your lyrics to be shared on the site.</p>
      <form id="share-lyrics-form" method="POST" action="https://api.staticman.net/v3/entry/github/autumnmarceau/glitchlette/main/lyrics-submissions">
        <label for="user-name">Name:</label><br />
        <input type="text" name="fields[name]" id="user-name" required autocomplete="name" /><br /><br />

        <label for="user-lyrics">Your Lyrics:</label><br />
        <textarea name="fields[lyrics]" id="user-lyrics" rows="8" required></textarea><br /><br />

        <button type="submit" class="glitch-button" id="submit-btn">Submit Lyrics</button>
        <button type="button" id="close-share-form" class="glitch-button">Cancel</button>

        <div id="form-message" role="alert" aria-live="assertive" style="margin-top: 1rem; color: #ff9999;"></div>
      </form>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Lyric source text
  const lyrics = `
Nor yet no vain wraiths nor quiet ghosts
constrained Thy chariot to go backward
Such as that, they say, in diverse places
The wraiths walk of ghosts dying or dead

There I stayed
Look what I have left

Inuman in unison
Heretics with arrogance
Forks between our chests and chin
Diagrams with evidence

There I stayed
Look what I have left

I don't wanna miss you

She was a forest fire
a single embered spark out of control
The toxic heat
it seeped into
the hollow yearning walls

it left this place empty
it left me empty
she left empty

you are a windstorm
from the inside out
you purged this house
foundation rattled and cried out
This is how I write a love song

I write a love song
She left me empty
You always fill me
They leave me empty
You always fill me
But can you feel me?
Will you leave me empty?

I don't wanna miss you

Cover the abyss
With a trance of madness
So my careful heart can manage
A safe way around it

I only hear the...

Cling to what you said
Tangled in my bed
I plead and repent
Fuckin innocent

I only hear the
Crying in my head
Who is listening?
Mental dissonance
Fuckin innocent

I feel I have to
Cling to what you said
Tangled in my bed
I plead and repent
Fuckin innocent

I only hear the
Crying in my head
Who is listening?
Mental dissonance
Fuckin innocent

I only hear her

I'm in over my head
Flashing lights crash through the window you are under
with your head cradled like sand in my hands

Are you crying?
Should I worry?
I know I can be the things that you can't
Are you sleeping?
Did you hear me?
Wish you would give me the things that you can't

Cradled like sand in my hands

When I'm in love
I let it consume me
Pour it and fill every cell in my body
With fire they crumble to ash
when it leaves me
So much to grieve when you leave

When I want love
I let it consume me
Pour it and fill every hole in my psyche
With first they crumble to ash
When you leave me

So much to grieve when she leaves
So much to grieve when you leaves

I could try to say
What festered in my brain
As you float in and out of sleep
I spill the words

And you say nothing
As you always do

I still hear your voice

What about time?
What about tears?
What about living through every year?
You know all about me
Now I can't forget you

Wish that I could say
That I cried while we putrified
As the blood smeared around my face
I started to smile
And I feel nothing
As I've always wished to

What about time?
what about tears?
What about living through all the years?
You knew all about me
Now I can't forgive you
What about time?
What about tears?
What about living through every year?
You knew everything about me
Now I can't forget you

I wish I could say in the night what came
Running through my head
Rotting in our bed
I wish I could say in the night what came
Rotting in our bed
Running through my head
I wish I could say

What about time?
What about tears?
What about living through every year?
You knew all about me
Now I can't forget you
What about time?
what about tears?
What about living through every year?
You knew all about me
Now I can't forgive you
What about time?
What about tears?
What about living through every year?
You knew everything about me
Now I can't forgive you
What about time?
what about tears?
What about living through every year?
You knew all about me
Now I can't forget you

I feel wasted baby
Devoured me like cheap wine
Am I wasted yet baby
Draw your hands away
when I reach with mine

I think its more painful this way
To be so far outside the blame
Nothing I could or change
To fix the way you

Played your games
With my heart so reckless
I've been foolish, darling
But you played into it
about
`;

  const words = lyrics
    .replace(/\n/g, ' ')
    .replace(/[^a-zA-Z0-9' ]+/g, '')
    .split(' ')
    .filter(Boolean);

  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function generateLyric() {
    const linesCount = randInt(3, 6);
    let output = '';
    for (let i = 0; i < linesCount; i++) {
      const wordsInLine = randInt(4, 8);
      let line = [];
      for (let j = 0; j < wordsInLine; j++) {
        const w = words[randInt(0, words.length - 1)];
        line.push(w);
      }
      output += line.join(' ') + '\n';
    }
    return output.trim();
  }

  const btn = document.getElementById('generate-btn');
  const output = document.getElementById('lyric-output');
  const copyBtn = document.getElementById('copy-btn');
  const copyConfirm = document.getElementById('copy-confirmation');
  const shareConfirm = document.getElementById('share-confirmation');

  btn.addEventListener('click', () => {
    output.textContent = generateLyric();
    copyConfirm.classList.remove('visible');
    shareConfirm.classList.remove('visible');
  });

  copyBtn.addEventListener('click', () => {
    if (!output.textContent.trim()) return;
    navigator.clipboard.writeText(output.textContent)
      .then(() => {
        copyConfirm.classList.add('visible');
        setTimeout(() => copyConfirm.classList.remove('visible'), 1500);
      })
      .catch(() => {
        alert('Failed to copy. Please try manually.');
      });
  });

  // Load shared lyrics from URL param if present
  const params = new URLSearchParams(window.location.search);
  const sharedLyrics = params.get('lyrics');
  if (sharedLyrics) {
    output.textContent = decodeURIComponent(sharedLyrics);
  }

  // Share modal elements
  const openShareBtn = document.getElementById('open-share-form');
  const closeShareBtn = document.getElementById('close-share-form');
  const shareModal = document.getElementById('share-modal');
  const shareForm = document.getElementById('share-lyrics-form');
  const userLyricsField = document.getElementById('user-lyrics');
  const userNameField = document.getElementById('user-name');
  const submitBtn = document.getElementById('submit-btn');
  const formMessage = document.getElementById('form-message');

  openShareBtn.addEventListener('click', () => {
    userLyricsField.value = output.textContent.trim() || '';
    userLyricsField.readOnly = true;
    userLyricsField.required = false;

    userNameField.value = '';
    userNameField.disabled = false;
    userNameField.required = true;

    formMessage.textContent = '';
    submitBtn.disabled = false;

    shareModal.classList.remove('hidden');
    userNameField.focus();
  });

  closeShareBtn.addEventListener('click', () => {
    shareModal.classList.add('hidden');
    formMessage.textContent = '';
    openShareBtn.focus();
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !shareModal.classList.contains('hidden')) {
      shareModal.classList.add('hidden');
      formMessage.textContent = '';
      openShareBtn.focus();
    }
  });

  shareForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    submitBtn.disabled = true;
    formMessage.style.color = '#ff9999';
    formMessage.textContent = 'Submitting...';

    const formData = {
      fields: {
        name: userNameField.value.trim(),
        lyrics: userLyricsField.value.trim()
      }
    };

    try {
      const response = await fetch(shareForm.action, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      if (response.ok) {
        formMessage.style.color = '#99ff99';
        formMessage.textContent = 'Thanks! Your lyrics have been shared.';
        userNameField.value = '';
        setTimeout(() => {
          shareModal.classList.add('hidden');
          formMessage.textContent = '';
          submitBtn.disabled = false;
          openShareBtn.focus();
        }, 2000);
      } else {
        const errorData = await response.json();
        formMessage.style.color = '#ff6666';
        formMessage.textContent = 'Failed to submit: ' + (errorData.message || response.statusText);
        submitBtn.disabled = false;
      }
    } catch (error) {
      formMessage.style.color = '#ff6666';
      formMessage.textContent = 'Network error: ' + error.message;
      submitBtn.disabled = false;
    }
  });

  // View Shared Lyrics button
  const viewSharedBtn = document.getElementById('view-shared-btn');
  if (viewSharedBtn) {
    viewSharedBtn.addEventListener('click', () => {
      window.location.href = '/lyrics/shared.html';
    });
  }
});
</script>

</body>
</html>
